<!DOCTYPE html>
<html>
  <head>
  <title>Junk Drawer : Advent of Code 2019 : Day 2</title>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  <!-- link to main stylesheet -->
  <link rel="stylesheet" type="text/css" href="https://benknoble.github.io/assets/css/styles.css" media="screen">

  <script src="/assets/js/scale.fix.js"></script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" >
  </script>

  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/assets/img/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link type="application/atom+xml" rel="alternate" href="https://benknoble.github.io/feed.xml" title="Junk Drawer" />
</head>

  <body>
    <header>
  <h1>
  <a href="https://benknoble.github.io/">
  <img src="/assets/img/logo.png" alt="Junk Drawer Logo" width="32" height="32"> Junk Drawer</a>
</h1>
  <p>For all those little papers scattered across your desk</p>
</header>

    <section>
      <nav>
  <ul>
    
    <li class="">
      <a href="https://benknoble.github.io/about/">About</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/categories/">Posts</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/workshops/">Workshops</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/papers/">Papers</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/writings/">Writings</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/reading/">Reading List</a>
    </li>
    
  </ul>
</nav>

      <h1>Advent of Code 2019 : Day 2</h1>
      <p class="meta"><span class="authors">
  
  
    D. Ben Knoble
  
</span>
 on 17 Dec 2019 in Blog</p>
<div id="post">
  <p>In this episode, the intcode computer is born.</p>

<h2 id="part-1">Part 1</h2>

<h3 id="03f2564"><a href="https://github.com/benknoble/advent2019/commit/03f256405838cdb75dccaea5f2db5c0f928f39bc">03f2564</a></h3>

<p>Part 1 consisted of implementing a simulator capable of evaluating programs
described in intcode. Intcode is a list of comma-separated integers, each of
which may be an instruction or address at any given moment. Later challenges add
even more items to that list.</p>

<p>I was initially going to split this up into nice structures and functors (a
type-level function that converts structures into structures), but I struggled
do so.</p>

<p>In the end, memory and the interpreter all lived in the same structure. The only
operations to support were arithmetic, so it wasn’t an issue at the time.</p>

<p>The actual solution then becomes another parsing problem (the instructions),
composed with a “fixer” that writes some values into memory, composed with an
interpret-to-finish operation, composed with reading the 0th element of the
resulting memory.</p>

<p>I am proud that I recognized this as a state-machine problem, and found a way to
encode every computation for an intcode program in a state-machine complete with
transition function (more on that in future episodes <img class="emoji" title=":wink:" alt=":wink:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f609.png" height="20" width="20">).</p>

<p>For a good overview of state-machines and other topics, I recommend <em>Elements of
the Theory of Computation</em>, by Lewis and Papadimitriou.</p>

<p>I’m still working out all the ramifications, but I believe that the intcode
computer (especially with later-day modifications) is Turing complete; at the
very least, with a few modifications of today’s architecture, the halting
problem for intcode becomes undecidable. So I believe this means we do not have
a <em>finite</em> state-machine, but rather a <em>possibly-infinite</em> state-machine.</p>

<p>Briefly, a state-machine is the tuple \((\Sigma, \delta)\) where \(\Sigma\) is
the arbitrarily-complex set of states and \(\delta : \Sigma \to \Sigma\) is the
transition function. Note that a state may be a simple object, such as a single
symbol, or a complex object, like a tuple of a memory object, an instruction
pointer, and a few machine registers. (Traditionally, the input set is
\(\Sigma\) and the states are elements of \(K\); however, in the case of
intcode, a state include the “input” elements such as next instruction pointer,
etc.)</p>

<p>Given this machine, one feeds an input state \(\sigma \in \Sigma\) through
repeated applications of \(\delta\). So, for example, the \(n\)-th iteration of
the machine is the value \(\delta(\delta(\delta(\dots(\sigma)\dots))) =
\delta^n(\sigma)\). When we reach a special state \(\omega \in \Sigma\) that we
designate the “halting state,” the machine halts. (We can refine this to include
any state \(\omega\) in the set of halting states \(\Omega\), if we wish—and
in fact, later intcode simulators do).</p>

<p>We can now model an interpreter for this state-machine as the closures of
\(\delta\)—call it \(\Delta\)—which is the application of \(\delta\) until
we reach a halting state. Alternately, if we make each halting state a
<em>fix-point</em> (if \(f(x) = x\), then \(x\) is a fix-point of \(f\)), then
\(\Delta\) is still the closure of \(\delta\), though now until we reach the
fix-point.</p>

<p>I am least proud of the fact that this version used exceptions. Ick.</p>

<h2 id="part-2">Part 2</h2>

<h3 id="9b0f469"><a href="https://github.com/benknoble/advent2019/commit/9b0f469d9502842209e028cd884e5c2ac4f6d50e">9b0f469</a></h3>

<p>I wrapped some <code class="language-plaintext highlighter-rouge">List</code> exceptions for convenience. I also wrapped instructions
with their parameters and added a <code class="language-plaintext highlighter-rouge">decode</code> function that reads memory to create
the next instruction. Most of the rest is unchanged.</p>

<p>Part 2 mainly consisted of searching a (relatively small) search-space for
values which produced a certain target, so I implemented that outside of all the
intcode structures. I slapped together a search space (cartesian product), a
runner function, and a checker function. Then I added a <code class="language-plaintext highlighter-rouge">first</code> function which
finds the first <code class="language-plaintext highlighter-rouge">(noun, verb)</code> pair that produces the requisite target. It
constrains the search space to the given bound (later chosen to be <code class="language-plaintext highlighter-rouge">n=99</code>).</p>

<p>Then the solution consists of loading up the program, running it in the search
space, and extracting the answer from the pair.</p>

<h3 id="3ad3126"><a href="https://github.com/benknoble/advent2019/commit/3ad3126fcb655a2ddc638733f6104adbc26ffc84">3ad3126</a></h3>

<p>This commit was the <em>slight</em> refactoring to use more standard naming
conventions. SML programmers typically prefer lower case, then <code class="language-plaintext highlighter-rouge">camelCase</code>, for
types and identifiers. Structures are the special guys that get <code class="language-plaintext highlighter-rouge">TitleCase</code>,
while functors require <code class="language-plaintext highlighter-rouge">Fn</code> at the end and signatures are in <code class="language-plaintext highlighter-rouge">SHOUTYCAPS</code>.</p>

<h3 id="fa5bcae"><a href="https://github.com/benknoble/advent2019/commit/fa5bcaef65849697873b053a6031fe579cb857dd">fa5bcae</a></h3>

<p>This very short commit was another refactor: semantically, I tend to associate
compilation with source-transformation. All we do with an intcode program is
load it into a runnable state, so no transforming done there.</p>

<p>While we’re discussing these kinds of programs (compilers and interpreters), I
should mention that I’m probably going to write an intcode assembler by the time
this is all said and done. It’s not too difficult. Going the other way is
impossible without executing the code, though, as an instruction might later be
read and modified by a different instruction. I could even support labels… hm
<img class="emoji" title=":thinking:" alt=":thinking:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f914.png" height="20" width="20">.</p>

</div>
<hr>
<h4>Tags:</h4>
<ul class="tags">
  
    <li>
      <a href="https://benknoble.github.io/tags#advent+of+code" class="tag">
        advent of code
      </a>
    </li>
  
    <li>
      <a href="https://benknoble.github.io/tags#sml%2Fnj" class="tag">
        sml/nj
      </a>
    </li>
  
    <li>
      <a href="https://benknoble.github.io/tags#intcode" class="tag">
        intcode
      </a>
    </li>
  
</ul>

<div id="post-categories">
  <h4>Categories:
  
    <a href="/categories/#blog">Blog</a>
    
  
  </h4>
</div>

<div id="disqus_thread"></div>
<div class="load-comments" onclick="load_comments(this)">Load Comments</div>
<script>
  var disqus_shortname = 'https-benknoble-github-io';
  var disqus_config = function () {
    this.page.url = "https://benknoble.github.io/blog/2019/12/17/advent2/";
    this.page.identifier = "/blog/2019/12/17/advent2";
  };

  function load_comments(div) {
    var d = document, s = d.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    div.parentNode.removeChild(div)
  };
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>


<div id="post-navigation">
  
  <span id="previous">
    <a href="https://benknoble.github.io/blog/2019/12/16/advent/" title="Advent of Code 2019 : Day 1">
      Previous</a>
  </span>
  
  
  <span id="next">
    <a href="https://benknoble.github.io/blog/2019/12/18/advent3/" title="Advent of Code 2019 : Day 3">
      Next</a>
  </span>
  
</div>
<div id="back-to-posts">
  <a href="/categories/#advent-of-code-2019-day-2">
    Back to posts</a>
</div>

    </section>
    <footer>
<hr>
  <ul>
    
    <li>
      <a href="https://benknoble.github.io/">Home</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/contact/">Contact</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/sitemap.xml">Sitemap</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/feed.xml">RSS Feed</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/colophon/">Colophon</a>
    </li>
    
    <li>
      <a href="https://github.com/benknoble/benknoble.github.io/blob/master/LICENSE">Copyright D. Ben Knoble <script type="text/javascript">document.write(new Date().getFullYear())</script></a>
    </li>
    
    <li>
      <p xmlns:cc="http://creativecommons.org/ns#"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" alt=""></a></p>
    </li>
  </ul>
</footer>

    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    <script>
      (function() {
        var script = document.createElement('script');
        window.counter = 'https://benknoble_github_io.goatcounter.com/count'
        script.async = 1;
        script.src = '//gc.zgo.at/count.js';

        var ins = document.getElementsByTagName('script')[0];
        ins.parentNode.insertBefore(script, ins)
      })();
    </script>
  </body>
</html>
