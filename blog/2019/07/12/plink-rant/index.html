<!DOCTYPE html>
<html>
  <head>
  <title>Junk Drawer : Something is rotten in the state of Dotfiles</title>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  <!-- link to main stylesheet -->
  <link rel="stylesheet" type="text/css" href="https://benknoble.github.io/assets/css/styles.css" media="screen">

  <script src="/assets/js/scale.fix.js"></script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" >
  </script>

  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/assets/img/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link type="application/atom+xml" rel="alternate" href="https://benknoble.github.io/feed.xml" title="Junk Drawer" />
</head>

  <body>
    <header>
  <h1>
  <a href="https://benknoble.github.io/">
  <img src="/assets/img/logo.png" alt="Junk Drawer Logo" width="32" height="32"> Junk Drawer</a>
</h1>
  <p>For all those little papers scattered across your desk</p>
</header>

    <section>
      <p>
      I stand for the Constitution, for due process, and for community that
      takes care of each other.
      </p>
      <nav>
  <ul>
    
    <li class="">
      <a href="https://benknoble.github.io/about/">About</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/categories/">Posts</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/workshops/">Workshops</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/papers/">Papers</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/writings/">Writings</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/reading/">Reading List</a>
    </li>
    
  </ul>
</nav>

      <h1>Something is rotten in the state of Dotfiles</h1>
      <p class="meta"><span class="authors">
  
  
    D. Ben Knoble
  
</span>
 on 12 Jul 2019 in Blog</p>
<div id="post">
  <p>After a <a href="https://github.com/benknoble/Dotfiles/commit/2662480d79a072cc55c58e444cc7c622085a621f">recent adventure</a> rewriting my entire <a href="https://github.com/benknoble/Dotfiles">Dotfiles</a> system
to use <a href="http://pubs.opengroup.org/onlinepubs/009695399/utilities/make.html">POSIX make</a>, I wanted something better.</p>

<p>First, let’s survey the state of Dotfiles the world over.</p>

<h2 id="the-good">The Good</h2>

<p>Most Dotfiles collections are shared on the internet via <a href="http://dotfiles.github.io">GitHub</a>, and
reading them is a fun pastime. They’re a great way to get insight into others’
workflow, and learn new tricks.</p>

<h2 id="the-bad">The Bad</h2>

<p>Most Dotfiles, however, use radically different setup schemes and directory
structures. Some have hand-crafted shell scripts (see my repo’s early
history…); some prefer self-written tools (thoughtbot uses an in-house ruby
tool called <code class="language-plaintext highlighter-rouge">rcm</code> IIRC); some use GNU Stow; some use make (myself included);
some just list instructions in the README.</p>

<p>As a programmer, this variety of tools is exciting when it means people are
thinking about how to solve the problem. Unfortunately, with few notable and
widespread exceptions, these tools are all hand-crafted. While I will argue that
Dotfiles are extremely personal and deserve to be hand-crafted, their management
may not deserve the same.</p>

<p>The difficulty with the variety is that is hard for me to benefit from someone
else’s setup script/tool/makefile/etc. It’s simply too personal, and often too
hand-written. At least with my original scripts I eventually converted to an
associative array, sticking with the convention that keys would be entries under
<code class="language-plaintext highlighter-rouge">links</code> and values would be the eventual symlinks under <code class="language-plaintext highlighter-rouge">~</code>.</p>

<h2 id="the-ugly">The Ugly</h2>

<p>This complaint is mostly because I took pains to get to POSIX make (and <em>only</em>
POSIX make), throwing out all the shell scripts I’d accumulated over the years,
the backups that get made of old Dotfiles, and the incessant prompting and
messaging. (I finally settled for a trust myself mentality there.)</p>

<p>But let’s take a look at some code from the current Makefile (the most recent
version is always on <a href="https://github.com/benknoble/Dotfiles">GitHub</a>):</p>

<div class="language-make highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">LINKS</span> <span class="o">=</span> links
<span class="c"># all the eventual symlinks in ~
</span><span class="nv">SYMLINKS</span> <span class="o">=</span> <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.ackrc <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.bash <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.bash_profile <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.bashrc <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.bin <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.ctags.d <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.git_template <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.gitconfig <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.gitignore_global <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.gitshrc <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.inputrc <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.jupyter <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.pythonrc <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.tmplr <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.tmux.conf <span class="se">\</span>
<span class="p">$(</span>HOME<span class="p">)</span>/.vim <span class="se">\</span>


<span class="c"># note the extra trailing newline,
# just so I don't have to see diffs with \ in them
</span>
<span class="c"># dependencies
</span><span class="nl">$(HOME)/.ackrc</span><span class="o">:</span> <span class="nf">$(LINKS)/ackrc</span>
<span class="nl">$(HOME)/.bash</span><span class="o">:</span> <span class="nf">$(LINKS)/bash</span>
<span class="nl">$(HOME)/.bash_profile</span><span class="o">:</span> <span class="nf">$(LINKS)/bash_profile</span>
<span class="nl">$(HOME)/.bashrc</span><span class="o">:</span> <span class="nf">$(LINKS)/bashrc</span>
<span class="nl">$(HOME)/.bin</span><span class="o">:</span> <span class="nf">$(LINKS)/bin</span>
<span class="nl">$(HOME)/.ctags.d</span><span class="o">:</span> <span class="nf">$(LINKS)/ctags.d</span>
<span class="nl">$(HOME)/.git_template</span><span class="o">:</span> <span class="nf">$(LINKS)/git_template</span>
<span class="nl">$(HOME)/.gitconfig</span><span class="o">:</span> <span class="nf">$(LINKS)/gitconfig</span>
<span class="nl">$(HOME)/.gitignore_global</span><span class="o">:</span> <span class="nf">$(LINKS)/gitignore_global</span>
<span class="nl">$(HOME)/.gitshrc</span><span class="o">:</span> <span class="nf">$(LINKS)/gitshrc</span>
<span class="nl">$(HOME)/.inputrc</span><span class="o">:</span> <span class="nf">$(LINKS)/inputrc</span>
<span class="nl">$(HOME)/.jupyter</span><span class="o">:</span> <span class="nf">$(LINKS)/jupyter</span>
<span class="nl">$(HOME)/.pythonrc</span><span class="o">:</span> <span class="nf">$(LINKS)/pythonrc</span>
<span class="nl">$(HOME)/.tmplr</span><span class="o">:</span> <span class="nf">$(LINKS)/tmplr</span>
<span class="nl">$(HOME)/.tmux.conf</span><span class="o">:</span> <span class="nf">$(LINKS)/tmux.conf</span>
<span class="nl">$(HOME)/.vim</span><span class="o">:</span> <span class="nf">$(LINKS)/vim</span>
</code></pre></div></div>

<p>Yes, I copy-pasta’d that verbatim for your benefit. Look at the overwhelming
redundancy! It makes the programmer cringe: why bother writing code to automate
these tasks if you can’t write <em>good</em> code? This is begging me to update one
list and not the other; adding only to <code class="language-plaintext highlighter-rouge">SYMLINKS</code> will cause <code class="language-plaintext highlighter-rouge">make symlinks</code> to
run all the time trying to build a file that won’t exist, while adding only to
the dependencies will cause <code class="language-plaintext highlighter-rouge">make symlinks</code> to ignore a symlink I want to
create! Ugh. There has to be a better solution</p>

<h2 id="plink">Plink</h2>

<p>My preferred solution would be a DSL that could generate exactly (or
near-exactly) the current Makefile I’m using. This DSL would let me specify the
necessary and sufficient information (how files link together), and figure out
the rest. It would output POSIX make for any generated code.</p>

<p>Better, it would give me syntactic sugar for common make idioms (like phony
targets to run commands), and pass on <em>everything</em> that isn’t part of its syntax
exactly as-is to make (this includes <code class="language-plaintext highlighter-rouge">#</code> comments!).</p>

<p>Finally, if the program generates a Makefile, it might as well have all targets
it creates (and possibly all targets, though this requires parsing make
constructs) depend on the original DSL file! Then, with careful writing, <code class="language-plaintext highlighter-rouge">make
symlink</code> will first rebuild the Makefile if necessary, <em>then</em> generate the
missing symlinks.</p>

<p>Enter, <code class="language-plaintext highlighter-rouge">plink</code>. It’s in rough design stage, but it should look something like
this when I’m done (this would be called something like <code class="language-plaintext highlighter-rouge">links.plink</code>):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /usr/bin/env ./plink_submodule/plink</span>

<span class="c"># literal make syntax</span>
MY_VAR <span class="o">=</span> value

target: <span class="si">$(</span>MY_VAR<span class="si">)</span>

<span class="c"># describes that the file ~/link comes from the file ./dotfile</span>
<span class="nb">link</span> &lt;<span class="o">=</span> dotfile

<span class="c"># gives me a target with a recipe consisting of exactly the text of command</span>
phony_name <span class="o">!</span> <span class="nb">command</span>

<span class="c"># gives me a target with a recipe consisting of exactly the text of commands...</span>
phony_name2 <span class="o">!!</span>
commands...
<span class="o">!!</span>
</code></pre></div></div>

<p>It shall be called plink because I will be writing in Perl and it will be used
to manage my symlink-based Dotfiles. It will be so easy to use that all you need
is to make plink a submodule, create your executable plink file (if you don’t
have <code class="language-plaintext highlighter-rouge">env</code>, just make the interpreter the relative path to <code class="language-plaintext highlighter-rouge">plink</code>), and run it
to get a Makefile with the semantics I’ve described above.</p>

<p>The <code class="language-plaintext highlighter-rouge">env</code> magic is to work around the fact that interpreters on shebangs cannot
be nested (since <code class="language-plaintext highlighter-rouge">plink</code> starts with <code class="language-plaintext highlighter-rouge">#! /usr/bin/env perl</code>, this is an issue).
<code class="language-plaintext highlighter-rouge">env</code> doesn’t care. It runs plink just fine.</p>

<p>I’m still working exactly the design of plink (I need to decide how ordering of
the plink file will work, and if there are semantics for what becomes the
default make target—and I really need to decide whether or not to generate
unspecified code: see the lines for <code class="language-plaintext highlighter-rouge">SUFFIXES</code> and <code class="language-plaintext highlighter-rouge">SHELL</code> in the original). But
it should be done soon—that’s the advantage of Perl’s text-processing power.</p>

<p>P.S. I know I’m solving a tool problem with another hand-crafted tool, but the
DSL is just too powerful to resist, and it could easily be universal because it
emits POSIX make. Users can customize as they want because of the way it passes
everything else literally to make.</p>

<p>P.P.S. A vim plugin for plink will be stupid simple: I just have to include the
make syntax, then add some rules for plink’s syntax, and we’re off to the races.</p>


</div>
<hr>
<h4>Tags:</h4>
<ul class="tags">
  
    <li>
      <a href="https://benknoble.github.io/tags#dotfiles" class="tag">
        dotfiles
      </a>
    </li>
  
    <li>
      <a href="https://benknoble.github.io/tags#make" class="tag">
        make
      </a>
    </li>
  
    <li>
      <a href="https://benknoble.github.io/tags#perl" class="tag">
        perl
      </a>
    </li>
  
    <li>
      <a href="https://benknoble.github.io/tags#shell" class="tag">
        shell
      </a>
    </li>
  
    <li>
      <a href="https://benknoble.github.io/tags#DSL" class="tag">
        DSL
      </a>
    </li>
  
    <li>
      <a href="https://benknoble.github.io/tags#rants" class="tag">
        rants
      </a>
    </li>
  
    <li>
      <a href="https://benknoble.github.io/tags#design" class="tag">
        design
      </a>
    </li>
  
    <li>
      <a href="https://benknoble.github.io/tags#posix" class="tag">
        posix
      </a>
    </li>
  
</ul>

<div id="post-categories">
  <h4>Categories:
  
    <a href="/categories/#blog">Blog</a>
    
  
  </h4>
</div>

<div id="disqus_thread"></div>
<div class="load-comments" onclick="load_comments(this)">Load Comments</div>
<script>
  var disqus_shortname = 'https-benknoble-github-io';
  var disqus_config = function () {
    this.page.url = "https://benknoble.github.io/blog/2019/07/12/plink-rant/";
    this.page.identifier = "/blog/2019/07/12/plink-rant";
  };

  function load_comments(div) {
    var d = document, s = d.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    div.parentNode.removeChild(div)
  };
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>


<div id="post-navigation">
  
  <span id="previous">
    <a href="https://benknoble.github.io/blog/2019/07/03/ally/" title="I am an ally">
      Previous</a>
  </span>
  
  
  <span id="next">
    <a href="https://benknoble.github.io/release/2019/07/15/plink-release/" title=":tada: Announcing the release of plink! :tada:">
      Next</a>
  </span>
  
</div>
<div id="back-to-posts">
  <a href="/categories/#something-is-rotten-in-the-state-of-dotfiles">
    Back to posts</a>
</div>

    </section>
    <footer>
<hr>
  <ul>
    
    <li>
      <a href="https://benknoble.github.io/">Home</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/contact/">Contact</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/sitemap.xml">Sitemap</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/feed.xml">RSS Feed</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/colophon/">Colophon</a>
    </li>
    
    <li>
      <a href="https://github.com/benknoble/benknoble.github.io/blob/master/LICENSE">Copyright D. Ben Knoble</a>
    </li>
    
    <li>
      <p xmlns:cc="http://creativecommons.org/ns#"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" alt=""></a></p>
    </li>
  </ul>
</footer>

    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    <script>
      (function() {
        var script = document.createElement('script');
        window.counter = 'https://benknoble_github_io.goatcounter.com/count'
        script.async = 1;
        script.src = '//gc.zgo.at/count.js';

        var ins = document.getElementsByTagName('script')[0];
        ins.parentNode.insertBefore(script, ins)
      })();
    </script>
  </body>
</html>
