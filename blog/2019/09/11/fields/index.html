<!DOCTYPE html>
<html>
  <head>
  <title>Junk Drawer : The Fields Extracter You Always Wanted</title>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  <!-- link to main stylesheet -->
  <link rel="stylesheet" type="text/css" href="https://benknoble.github.io/assets/css/styles.css" media="screen">

  <script src="/assets/js/scale.fix.js"></script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" >
  </script>

  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/assets/img/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link type="application/atom+xml" rel="alternate" href="https://benknoble.github.io/feed.xml" title="Junk Drawer" />
</head>

  <body>
    <header>
  <h1>
  <a href="https://benknoble.github.io/">
  <img src='/assets/img/logo.png' alt='Junk Drawer Logo' width=32 height=32> Junk Drawer</a></h1>
  <p>For all those little papers scattered across your desk</p>
</header>

    <section>
      <nav>
  <ul>
    
    <li class="">
      <a href="https://benknoble.github.io/about/">About</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/categories/">Posts</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/workshops/">Workshops</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/papers/">Papers</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/writings/">Writings</a>
    </li>
    
    <li class="">
      <a href="https://benknoble.github.io/reading/">Reading List</a>
    </li>
    
  </ul>
</nav>

      <h1>The Fields Extracter You Always Wanted</h1>
      <p class="meta"><span class="authors">
  
  
    D. Ben Knoble
  
</span>
 on 11 Sep 2019 in Blog</p>
<div id="post">
  <p>Ever <code class="language-plaintext highlighter-rouge">awk</code>‘d a bunch of fields out of a pipeline? Tired of typing single quotes,
dollar signs, and prints, when you just want the fields? Me too.</p>

<p>See <a href="https://github.com/benknoble/Dotfiles/blob/master/links/bin/fields">github</a>
for the most up-to-date version.</p>

<p><strong>Update 17th September 2019</strong>: The <code class="language-plaintext highlighter-rouge">cut(1)</code> version only works if you use
<em>exactly</em> tabs between your fields. <code class="language-plaintext highlighter-rouge">awk(1)</code> is less picky about delimiters,
matching whitespace by default (and controllable with <code class="language-plaintext highlighter-rouge">FS</code> or <code class="language-plaintext highlighter-rouge">-F</code>). So, while
<code class="language-plaintext highlighter-rouge">awk(1)</code> is “reinventing the wheel” in one sense, I think it’s really extending
it. Most command output that I care about does not use tabs, so <code class="language-plaintext highlighter-rouge">awk(1)</code> is more
robust than <code class="language-plaintext highlighter-rouge">cut(1)</code>.</p>

<p><strong>Update 15th September 2019</strong>: Most of this can be done with <code class="language-plaintext highlighter-rouge">cut(1)</code> via the
<code class="language-plaintext highlighter-rouge">-f</code> flag. I might rewrite the script to take advantage of this, but preserve
the same functionality.</p>

<h2 id="example">Example</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ls -l | fields 1 9</span>
total
<span class="nt">-rw-r--r--</span> 404.md
<span class="nt">-rw-r--r--</span> Gemfile
<span class="nt">-rw-r--r--</span> Gemfile.lock
<span class="nt">-rw-r--r--</span> LICENSE
<span class="nt">-rw-r--r--</span> README.md
<span class="nt">-rw-r--r--</span> Session.vim
<span class="nt">-rw-r--r--</span> _config.yml
drwxr-xr-x _data/
drwxr-xr-x _drafts/
drwxr-xr-x _includes/
drwxr-xr-x _layouts/
drwxr-xr-x _posts/
drwxr-xr-x _sass/
drwxr-xr-x _site/
drwxr-xr-x _writings/
drwxr-xr-x assets/
<span class="nt">-rw-r--r--</span> index.md
drwxr-xr-x pages/
<span class="nt">-rwxr-xr-x</span> serve<span class="k">*</span>
drwxr-xr-x sitemap-styles/
lrwxr-xr-x sitemap.xsl@
drwxr-xr-x subs/
<span class="nt">-rwxr-xr-x</span> tags-list<span class="k">*</span>
</code></pre></div></div>

<h2 id="how">How?</h2>

<p>The script (below) is a wrapper around <code class="language-plaintext highlighter-rouge">awk(1)</code>: we just generated the code we
would normally type by hand, and feed it to <code class="language-plaintext highlighter-rouge">awk(1)</code>.</p>

<p>If you’re concerned about timing to generate code, replacing <code class="language-plaintext highlighter-rouge">eval</code> with <code class="language-plaintext highlighter-rouge">echo</code>
and running <code class="language-plaintext highlighter-rouge">fields {1..100}</code> takes 0.012s on my machine. (If you’re pulling out
100 fields, I have questions for you…)</p>

<p>I’m considering replacing <code class="language-plaintext highlighter-rouge">eval</code> with <code class="language-plaintext highlighter-rouge">exec</code>, but we will have to see.</p>

<h2 id="the-script">The script</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /usr/bin/env bash</span>

<span class="nb">set</span> <span class="nt">-euo</span> pipefail

log<span class="o">()</span> <span class="o">{</span>
  <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="o">}</span> <span class="o">&gt;</span>&amp;2

usage<span class="o">()</span> <span class="o">{</span>
  <span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">DOG</span><span class="sh">
usage: </span><span class="nv">$0</span><span class="sh"> field...
</span><span class="no">DOG
</span><span class="o">}</span>

die<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">ex</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">1</span><span class="k">}</span><span class="s2">"</span>
  <span class="nb">exit</span> <span class="s2">"</span><span class="nv">$ex</span><span class="s2">"</span>
<span class="o">}</span>

usage_and_die<span class="o">()</span> <span class="o">{</span> usage <span class="o">&amp;&amp;</span> die<span class="p">;</span> <span class="o">}</span>

generate_awk_code<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">fields</span><span class="o">=(</span><span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="o">)</span>
  <span class="k">case</span> <span class="nv">$# </span><span class="k">in
    </span>0<span class="p">)</span> <span class="k">return</span> <span class="p">;;</span>
  <span class="k">esac</span>
  <span class="nb">printf</span> <span class="s2">"'{ print "</span>
  <span class="c"># from the beginning to the second to last</span>
  <span class="k">for </span>field <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">fields</span><span class="p">[@]</span>:0:<span class="k">${#</span><span class="nv">fields</span><span class="p">[@]</span><span class="k">}</span><span class="p">-1</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    </span><span class="nb">printf</span> <span class="s1">'$%d, '</span> <span class="s2">"</span><span class="nv">$field</span><span class="s2">"</span>
  <span class="k">done</span>
  <span class="c"># last</span>
  <span class="nb">printf</span> <span class="s1">'$%d'</span> <span class="s2">"</span><span class="k">${</span><span class="nv">fields</span><span class="p">[</span><span class="k">${#</span><span class="nv">fields</span><span class="p">[@]</span><span class="k">}</span><span class="p">-1]</span><span class="k">}</span><span class="s2">"</span>
  <span class="nb">printf</span> <span class="s2">" }'"</span>
<span class="o">}</span>

main<span class="o">()</span> <span class="o">{</span>
  <span class="nb">eval awk</span> <span class="s2">"</span><span class="si">$(</span>generate_awk_code <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
<span class="o">}</span>

main <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</code></pre></div></div>

</div>
<hr/>
<h4>Tags:</h4>
<ul class="tags">
  
    <li>
      <a href="https://benknoble.github.io/tags#shell" class="tag">
        shell
      </a>
    </li>
  
    <li>
      <a href="https://benknoble.github.io/tags#awk" class="tag">
        awk
      </a>
    </li>
  
</ul>

<div id="post-categories">
  <h4>Categories:
  
    <a href="/categories/#blog">Blog</a>
    
  
  </h4>
</div>

<div id="disqus_thread"></div>
<div class="load-comments" onclick="load_comments(this)">Load Comments</div>
<script>
  var disqus_shortname = 'https-benknoble-github-io';
  var disqus_config = function () {
    this.page.url = "https://benknoble.github.io/blog/2019/09/11/fields/";
    this.page.identifier = "/blog/2019/09/11/fields";
  };

  function load_comments(div) {
    var d = document, s = d.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    div.parentNode.removeChild(div)
  };
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


<div id="post-navigation">
  
  <span id="previous">
    <a href="https://benknoble.github.io/blog/2019/08/27/types-alignment/"
      title="The Alignment Axes of Type Systems">
      Previous</a>
  </span>
  
  
  <span id="next">
    <a href="https://benknoble.github.io/blog/2019/09/27/perl-v-bash/"
       title="Re: How Did Perl Lose Ground to Bash?">
      Next</a>
  </span>
  
</div>
<div id="back-to-posts">
  <a href="/categories/#the-fields-extracter-you-always-wanted">
    Back to posts</a>
</div>

    </section>
    <footer>
<hr/>
  <ul>
    
    <li>
      <a href="https://benknoble.github.io/">Home</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/contact/">Contact</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/sitemap.xml">Sitemap</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/feed.xml">RSS Feed</a>
    </li>
    
    <li>
      <a href="https://benknoble.github.io/colophon/">Colophon</a>
    </li>
    
    <li>
      <a href="https://github.com/benknoble/benknoble.github.io/blob/master/LICENSE">Copyright D. Ben Knoble <script type='text/javascript'>document.write(new Date().getFullYear())</script></a>
    </li>
    
    <li>
      <p xmlns:cc="http://creativecommons.org/ns#" ><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" alt=""></a></p>
    </li>
  </ul>
</footer>

    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    <script>
      (function() {
        var script = document.createElement('script');
        window.counter = 'https://benknoble_github_io.goatcounter.com/count'
        script.async = 1;
        script.src = '//gc.zgo.at/count.js';

        var ins = document.getElementsByTagName('script')[0];
        ins.parentNode.insertBefore(script, ins)
      })();
    </script>
  </body>
</html>
